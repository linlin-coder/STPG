apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: teset-
spec:
  arguments:
    parameters:
    - name: OUTDIR
      value: D:\message_about_myself\program-project\STPG\STPG_public\template\Test
    - name: bindir
      value: D:\message_about_myself\program-project\STPG\STPG_public\template
  entrypoint: teset-dag
  imagePullSecrets:
  - name: ''
  templates:
  - container:
      args:
      - sh {{inputs.parameters.shell}} 1>{{inputs.parameters.shell}}.o.${MY_POD_NAME}
        2>{{inputs.parameters.shell}}.e.${MY_POD_NAME}
      command:
      - sh
      - -c
      env:
      - name: MY_POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      image: alpine:3.13.5
      imagePullPolicy: IfNotPresent
      resources:
        limits:
          cpu: 1.0
          memory: 1.2Gi
        requests:
          cpu: 1.0
          memory: 1Gi
      securityContext:
        runAsGroup: 511
      volumeMounts:
      - mountPath: /etc/localtime
        name: timezone
      - mountPath: /data/
        name: sge
      - mountPath: /share/
        name: workdir
      - mountPath: /home
        name: home
      - mountPath: /nas/
        name: nas
      workingDir: D:\message_about_myself\program-project\STPG\STPG_public\template\Test\QC\merge_data
    inputs:
      parameters:
      - name: shell
    name: merge_data
    nodeSelector: {}
    tolerations: []
  - name: merge_data-TaskGroup
    steps:
    - - arguments:
          parameters:
          - name: shell
            value: QC-merge_data_A1.sh
        name: QC-merge_data_A1
        template: merge_data
      - arguments:
          parameters:
          - name: shell
            value: QC-merge_data_A2.sh
        name: QC-merge_data_A2
        template: merge_data
      - arguments:
          parameters:
          - name: shell
            value: QC-merge_data_A3.sh
        name: QC-merge_data_A3
        template: merge_data
      - arguments:
          parameters:
          - name: shell
            value: QC-merge_data_B1.sh
        name: QC-merge_data_B1
        template: merge_data
      - arguments:
          parameters:
          - name: shell
            value: QC-merge_data_B2.sh
        name: QC-merge_data_B2
        template: merge_data
      - arguments:
          parameters:
          - name: shell
            value: QC-merge_data_B3.sh
        name: QC-merge_data_B3
        template: merge_data
    - - arguments:
          parameters:
          - name: FinishSign
            value: finished
          - name: module_name
            value: merge_data
          - name: ini_dir
            value: D:\message_about_myself\program-project\STPG\STPG_public\template\Test\QC
        name: merge_data-Finish
        template: FINISH-STEP
  - container:
      args:
      - sh {{inputs.parameters.shell}} 1>{{inputs.parameters.shell}}.o.${MY_POD_NAME}
        2>{{inputs.parameters.shell}}.e.${MY_POD_NAME}
      command:
      - sh
      - -c
      env:
      - name: MY_POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      image: alpine:3.13.5
      imagePullPolicy: IfNotPresent
      resources:
        limits:
          cpu: 1.0
          memory: 1.2Gi
        requests:
          cpu: 1.0
          memory: 1Gi
      securityContext:
        runAsGroup: 511
      volumeMounts:
      - mountPath: /etc/localtime
        name: timezone
      - mountPath: /data/
        name: sge
      - mountPath: /share/
        name: workdir
      - mountPath: /home
        name: home
      - mountPath: /nas/
        name: nas
      workingDir: D:\message_about_myself\program-project\STPG\STPG_public\template\Test\QC\qc
    inputs:
      parameters:
      - name: shell
    name: qc
    nodeSelector: {}
    tolerations: []
  - name: qc-TaskGroup
    steps:
    - - arguments:
          parameters:
          - name: shell
            value: QC-qc_A1.sh
        name: QC-qc_A1
        template: qc
      - arguments:
          parameters:
          - name: shell
            value: QC-qc_A2.sh
        name: QC-qc_A2
        template: qc
      - arguments:
          parameters:
          - name: shell
            value: QC-qc_A3.sh
        name: QC-qc_A3
        template: qc
      - arguments:
          parameters:
          - name: shell
            value: QC-qc_B1.sh
        name: QC-qc_B1
        template: qc
      - arguments:
          parameters:
          - name: shell
            value: QC-qc_B2.sh
        name: QC-qc_B2
        template: qc
      - arguments:
          parameters:
          - name: shell
            value: QC-qc_B3.sh
        name: QC-qc_B3
        template: qc
    - - arguments:
          parameters:
          - name: FinishSign
            value: finished
          - name: module_name
            value: qc
          - name: ini_dir
            value: D:\message_about_myself\program-project\STPG\STPG_public\template\Test\QC
        name: qc-Finish
        template: FINISH-STEP
  - container:
      args:
      - sh {{inputs.parameters.shell}} 1>{{inputs.parameters.shell}}.o.${MY_POD_NAME}
        2>{{inputs.parameters.shell}}.e.${MY_POD_NAME}
      command:
      - sh
      - -c
      env:
      - name: MY_POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      image: alpine:3.13.5
      imagePullPolicy: IfNotPresent
      resources:
        limits:
          cpu: 1.0
          memory: 1.2Gi
        requests:
          cpu: 1.0
          memory: 1Gi
      securityContext:
        runAsGroup: 511
      volumeMounts:
      - mountPath: /etc/localtime
        name: timezone
      - mountPath: /data/
        name: sge
      - mountPath: /share/
        name: workdir
      - mountPath: /home
        name: home
      - mountPath: /nas/
        name: nas
      workingDir: D:\message_about_myself\program-project\STPG\STPG_public\template\Test\QC\qc_summary
    inputs:
      parameters:
      - name: shell
    name: qc_summary
    nodeSelector: {}
    tolerations: []
  - name: qc_summary-TaskGroup
    steps:
    - - arguments:
          parameters:
          - name: shell
            value: QC-qc_summary.sh
        name: QC-qc_summary
        template: qc_summary
    - - arguments:
          parameters:
          - name: FinishSign
            value: finished
          - name: module_name
            value: qc_summary
          - name: ini_dir
            value: D:\message_about_myself\program-project\STPG\STPG_public\template\Test\QC
        name: qc_summary-Finish
        template: FINISH-STEP
  - container:
      args:
      - 'cd {{inputs.parameters.ini_dir}} && echo {{inputs.parameters.FinishSign}}
        >{{inputs.parameters.module_name}}.sign && echo \#[finish]: {{inputs.parameters.module_name}}
        finished at `date +''%Y-%m-%d %H:%M:%S''` >>log.txt'
      command:
      - sh
      - -c
      image: alpine:3.13.5
      imagePullPolicy: IfNotPresent
      resources:
        limits:
          cpu: 1
          memory: 0.5Gi
        requests:
          cpu: 0.1
          memory: 0.05Gi
      securityContext:
        runAsGroup: 511
      volumeMounts:
      - mountPath: /etc/localtime
        name: timezone
      - mountPath: /data/
        name: sge
      - mountPath: /share/
        name: workdir
      - mountPath: /home
        name: home
      - mountPath: /nas/
        name: nas
    inputs:
      parameters:
      - name: FinishSign
      - name: ini_dir
      - name: module_name
    name: FINISH-STEP
    retryStrategy:
      limit: 2
  - dag:
      failFast: false
      tasks:
      - dependencies: []
        name: merge_data_A1
        template: merge_data-TaskGroup
      - dependencies: []
        name: merge_data_A2
        template: merge_data-TaskGroup
      - dependencies: []
        name: merge_data_A3
        template: merge_data-TaskGroup
      - dependencies: []
        name: merge_data_B1
        template: merge_data-TaskGroup
      - dependencies: []
        name: merge_data_B2
        template: merge_data-TaskGroup
      - dependencies: []
        name: merge_data_B3
        template: merge_data-TaskGroup
      - dependencies:
        - merge_data_A1
        name: qc_A1
        template: qc-TaskGroup
      - dependencies:
        - merge_data_A2
        name: qc_A2
        template: qc-TaskGroup
      - dependencies:
        - merge_data_A3
        name: qc_A3
        template: qc-TaskGroup
      - dependencies:
        - merge_data_B1
        name: qc_B1
        template: qc-TaskGroup
      - dependencies:
        - merge_data_B2
        name: qc_B2
        template: qc-TaskGroup
      - dependencies:
        - merge_data_B3
        name: qc_B3
        template: qc-TaskGroup
      - dependencies:
        - qc_A1
        - merge_data_A1
        - qc_A2
        - merge_data_A2
        - qc_A3
        - merge_data_A3
        - qc_B1
        - merge_data_B1
        - qc_B2
        - merge_data_B2
        - qc_B3
        - merge_data_B3
        name: qc_summary
        template: qc_summary-TaskGroup
    name: teset-dag
  ttlSecondsAfterFinished: 1296000
  volumes:
  - name: sge
    nfs:
      path: /data1
      server: x400.bjannoroad.local
  - name: workdir
    nfs:
      path: /cloud
      server: x400.bjannoroad.local
  - name: home
    nfs:
      path: /cloud_home
      server: x400.bjannoroad.local
  - hostPath:
      path: /etc/localtime
      type: File
    name: timezone
  - name: nas
    nfs:
      path: /data1
      server: 1q7o0lul18-cjw52.cn-beijing.nas.aliyuncs.com
